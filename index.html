<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<title>DOA-Diagnostics Diagnose Verslag</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
<style>
body {
    font-family: Arial, sans-serif;
    background: #f5f8fa;
    margin: 0;
    padding: 0;
}
header {
    background: #42b0e5;
    color: white;
    padding: 15px 30px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}
header img {
    height: 50px;
}
.container {
    max-width: 900px;
    background: white;
    padding: 30px;
    margin: 30px auto;
    border-radius: 8px;
    box-shadow: 0 0 12px rgba(0,0,0,0.1);
}
.form-group {
    margin-bottom: 18px;
}
label {
    font-weight: bold;
    display: block;
    margin-bottom: 5px;
}
input, textarea {
    width: 100%;
    padding: 10px;
    font-size: 14px;
    border: 1px solid #ccc;
    border-radius: 4px;
}
.foto-sectie {
    border: 2px dashed #42b0e5;
    padding: 15px;
    margin-bottom: 20px;
    border-radius: 6px;
}
button {
    background: #42b0e5;
    color: white;
    border: none;
    padding: 12px 20px;
    font-size: 16px;
    border-radius: 4px;
    cursor: pointer;
}
button:hover {
    background: #3398c6;
}
</style>
</head>
<body>

<header>
    <div>DOA-DIAGNOSTICS DIAGNOSE VERSLAG</div>
    <img src="IMG_1971.png" alt="Logo">
</header>

<div class="container">
    <div class="form-group">
        <label>Opdrachtgever</label>
        <input type="text" id="opdrachtgever">
    </div>
    <div class="form-group">
        <label>Datum</label>
        <input type="date" id="datum">
    </div>
    <div class="form-group">
        <label>Kenteken</label>
        <input type="text" id="kenteken">
    </div>
    <div class="form-group">
        <label>Merk / Type</label>
        <input type="text" id="merk">
    </div>
    <div class="form-group">
        <label>Bouwjaar</label>
        <input type="text" id="bouwjaar">
    </div>
    <div class="form-group">
        <label>VIN</label>
        <input type="text" id="vin">
    </div>
    <div class="form-group">
        <label>Motorcode</label>
        <input type="text" id="motorcode">
    </div>
    <div class="form-group">
        <label>Kilometerstand</label>
        <input type="text" id="kilometerstand">
    </div>
    <div class="form-group">
        <label>Klachtomschrijving</label>
        <textarea id="klacht"></textarea>
    </div>
    <div class="form-group">
        <label>Diagnose</label>
        <textarea id="diagnose"></textarea>
    </div>
    <div class="form-group">
        <label>Verklaring van opdrachtgever</label>
        <textarea id="verklaring"></textarea>
    </div>

    <h3>Analyse van de permanente fouten</h3>
    <div class="foto-sectie">
        <label>Uitleg</label>
        <textarea></textarea>
        <label>Foto</label>
        <input type="file" accept="image/*">
    </div>

    <h3>Overige foto secties</h3>
    <div id="fotoSecties"></div>
    <button onclick="voegSectieToe()">âž• Voeg een nieuwe sectie toe</button>

    <br><br>
    <button onclick="genereerPDF()">ðŸ“„ Genereer PDF</button>
</div>

<script>
function voegSectieToe() {
    const sectie = document.createElement('div');
    sectie.className = 'foto-sectie';
    sectie.innerHTML = `
        <label>Uitleg</label>
        <textarea></textarea>
        <label>Foto</label>
        <input type="file" accept="image/*">
    `;
    document.getElementById('fotoSecties').appendChild(sectie);
}

async function genereerPDF() {
    const content = [];

    // Gegevensblokken
    const velden = [
        {label: "Opdrachtgever", id: "opdrachtgever"},
        {label: "Datum", id: "datum"},
        {label: "Kenteken", id: "kenteken"},
        {label: "Merk / Type", id: "merk"},
        {label: "Bouwjaar", id: "bouwjaar"},
        {label: "VIN", id: "vin"},
        {label: "Motorcode", id: "motorcode"},
        {label: "Kilometerstand", id: "kilometerstand"},
        {label: "Klachtomschrijving", id: "klacht"},
        {label: "Diagnose", id: "diagnose"},
        {label: "Verklaring van opdrachtgever", id: "verklaring"}
    ];
    velden.forEach(veld => {
        content.push({
            table: {
                widths: ['auto', '*'],
                body: [
                    [
                        { text: veld.label + ":", bold: true },
                        { text: document.getElementById(veld.id).value || '' }
                    ]
                ]
            },
            margin: [0,5,0,5]
        });
    });

    // Analyse blok
    const analyseSectie = document.querySelector('.foto-sectie');
    const uitleg = analyseSectie.querySelector('textarea').value.trim();
    const fileInput = analyseSectie.querySelector('input[type=file]');
    let analyseBlok = [];
    if (uitleg) analyseBlok.push({ text: 'Analyse van de permanente fouten:', bold: true, fontSize: 14, margin: [0,10,0,4] });
    if (uitleg) analyseBlok.push({ text: uitleg, bold: true, fontSize: 13, margin: [0,0,0,5] });
    if (fileInput.files.length > 0) {
        const imgData = await toDataURL(fileInput.files[0]);
        analyseBlok.push({ image: imgData, width: 300 });
    }
    if (analyseBlok.length) content.push({ stack: analyseBlok, unbreakable: true, margin: [0,10,0,10] });

    // Extra dynamische foto secties
    const extraSecties = document.querySelectorAll('#fotoSecties .foto-sectie');
    for (let sectie of extraSecties) {
        const uitleg = sectie.querySelector('textarea').value.trim();
        const fileInput = sectie.querySelector('input[type=file]');
        let blok = [];
        if (uitleg) blok.push({ text: uitleg, bold: true, fontSize: 13, margin: [0,0,0,5] });
        if (fileInput.files.length > 0) {
            const imgData = await toDataURL(fileInput.files[0]);
            blok.push({ image: imgData, width: 300 });
        }
        if (blok.length) content.push({ stack: blok, unbreakable: true, margin: [0,10,0,10] });
    }

    // PDF definitie
    const docDefinition = {
        pageMargins: [40, 80, 40, 60],
        header: {
            table: {
                widths: ['*', 60],
                body: [
                    [
                        { text: 'DOA-DIAGNOSTICS DIAGNOSE VERSLAG', bold: true, fontSize: 14, color: 'white', margin: [10,6,0,6]},
                        { image: 'IMG_1971.png', width: 50 }
                    ]
                ]
            },
            layout: {
                fillColor: () => '#42b0e5'
            }
        },
        content: content
    };

    if (window.innerWidth <= 768) {
        pdfMake.createPdf(docDefinition).open();
    } else {
        pdfMake.createPdf(docDefinition).download('DOA-Diagnostics_Diagnose_Verslag.pdf');
    }
}

function toDataURL(file) {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = e => resolve(e.target.result);
        reader.onerror = e => reject(e);
        reader.readAsDataURL(file);
    });
}
</script>

</body>
</html>